<?xml version="1.0" encoding="utf-8"?>
<odoo noupdate="True">

    <!-- Invoice to cerro castor, fiscal position changes taxes to exempt
   La cargamos aparte para poder cambiar el diario cuando la volvamos a cargar
   con fe -->
    <record id="demo_invoice_6" model="account.move">
        <field name="partner_id" ref="res_partner_cerrocastor"/>
        <field name="fiscal_position_id" model="account.fiscal.position" eval="obj().search([('company_id', '=', obj().env.ref('l10n_ar.company_ri').id), ('name', '=', 'Operaciones exentas')], limit=1).id"/>
        <field name="invoice_user_id" ref="base.user_demo"/>
        <field name="invoice_payment_term_id" ref="account.account_payment_term"/>
        <field name="type">out_invoice</field>
        <field name="invoice_date" eval="time.strftime('%Y-%m')+'-03'"/>
        <field name="company_id" ref="company_ri"/>
        <field name="invoice_incoterm_id" ref="account.incoterm_EXW"/>
        <field name="invoice_line_ids" eval="[
            (0, 0, {'product_id': ref('product.product_product_27'), 'price_unit': 642.0, 'quantity': 5}),
            (0, 0, {'product_id': ref('product_product_telefonia'), 'price_unit': 250.0, 'quantity': 1}),
            (0, 0, {'product_id': ref('product.product_product_25'), 'price_unit': 3245.0, 'quantity': 2}),
            (0, 0, {'product_id': ref('product_product_no_gravado'), 'price_unit': 50.0, 'quantity': 10}),
            (0, 0, {'product_id': ref('product_product_cero'), 'price_unit': 200.0, 'quantity': 1}),
            (0, 0, {'product_id': ref('product_product_exento'), 'price_unit': 100.0, 'quantity': 1}),
        ]"/>
    </record>
    <function model="account.move.line" name="_onchange_product_id" context="{'check_move_validity': False}">
        <value model="account.move.line" eval="obj().search([('move_id', '=', ref('demo_invoice_6'))]).ids"/>
    </function>
    <function model="account.move" name="_recompute_dynamic_lines" context="{'check_move_validity': False}">
        <value eval="[ref('demo_invoice_6')]"/>
        <value eval="True"/>
    </function>

    <!-- Export invoice to expresso, fiscal position changes tax to exempt (type 4 because it have services) -->
    <record id="demo_invoice_7" model="account.move">
        <field name="partner_id" ref="res_partner_expresso"/>
        <field name="invoice_user_id" ref="base.user_demo"/>
        <field name="fiscal_position_id" model="account.fiscal.position" eval="obj().search([('company_id', '=', obj().env.ref('l10n_ar.company_ri').id), ('name', '=', 'Operaciones exentas')], limit=1).id"/>
        <field name="invoice_payment_term_id" ref="account.account_payment_term"/>
        <field name="type">out_invoice</field>
        <field name="invoice_date" eval="time.strftime('%Y-%m')+'-03'"/>
        <field name="company_id" ref="company_ri"/>
        <field name="invoice_incoterm_id" ref="account.incoterm_EXW"/>
        <field name="invoice_line_ids" eval="[
            (0, 0, {'product_id': ref('product.product_product_27'), 'price_unit': 642.0, 'quantity': 5}),
            (0, 0, {'product_id': ref('product_product_telefonia'), 'price_unit': 250.0, 'quantity': 1}),
            (0, 0, {'product_id': ref('product.product_product_25'), 'price_unit': 3245.0, 'quantity': 2}),
            (0, 0, {'product_id': ref('product_product_no_gravado'), 'price_unit': 50.0, 'quantity': 10}),
            (0, 0, {'product_id': ref('product_product_cero'), 'price_unit': 200.0, 'quantity': 1}),
            (0, 0, {'product_id': ref('product_product_exento'), 'price_unit': 100.0, 'quantity': 1}),
        ]"/>
    </record>
    <function model="account.move.line" name="_onchange_product_id" context="{'check_move_validity': False}">
        <value model="account.move.line" eval="obj().search([('move_id', '=', ref('demo_invoice_7'))]).ids"/>
    </function>
    <function model="account.move" name="_recompute_dynamic_lines" context="{'check_move_validity': False}">
        <value eval="[ref('demo_invoice_7')]"/>
        <value eval="True"/>
    </function>


    <!-- Export invoice to expresso, fiscal position changes tax to exempt (type 1 because only products) -->
    <record id="demo_invoice_14" model="account.move">
        <field name="partner_id" ref="res_partner_expresso"/>
        <field name="invoice_user_id" ref="base.user_demo"/>
        <field name="fiscal_position_id" model="account.fiscal.position" eval="obj().search([('company_id', '=', obj().env.ref('l10n_ar.company_ri').id), ('name', '=', 'Operaciones exentas')], limit=1).id"/>
        <field name="invoice_payment_term_id" ref="account.account_payment_term"/>
        <field name="type">out_invoice</field>
        <field name="invoice_date" eval="time.strftime('%Y-%m')+'-20'"/>
        <field name="company_id" ref="company_ri"/>
        <field name="invoice_incoterm_id" ref="account.incoterm_EXW"/>
        <field name="invoice_line_ids" eval="[
            (0, 0, {'product_id': ref('product.product_product_27'), 'price_unit': 642.0, 'quantity': 5}),
        ]"/>
    </record>
    <function model="account.move.line" name="_onchange_product_id" context="{'check_move_validity': False}">
        <value model="account.move.line" eval="obj().search([('move_id', '=', ref('demo_invoice_14'))]).ids"/>
    </function>
    <function model="account.move" name="_recompute_dynamic_lines" context="{'check_move_validity': False}">
        <value eval="[ref('demo_invoice_14')]"/>
        <value eval="True"/>
    </function>


    <!-- Export invoice to expresso, fiscal position changes tax to exempt (type 2 because only service) -->
    <record id="demo_invoice_15" model="account.move">
        <field name="partner_id" ref="res_partner_expresso"/>
        <field name="invoice_user_id" ref="base.user_demo"/>
        <field name="fiscal_position_id" model="account.fiscal.position" eval="obj().search([('company_id', '=', obj().env.ref('l10n_ar.company_ri').id), ('name', '=', 'Operaciones exentas')], limit=1).id"/>
        <field name="invoice_payment_term_id" ref="account.account_payment_term"/>
        <field name="type">out_invoice</field>
        <field name="invoice_date" eval="time.strftime('%Y-%m')+'-20'"/>
        <field name="company_id" ref="company_ri"/>
        <field name="invoice_incoterm_id" ref="account.incoterm_EXW"/>
        <field name="invoice_line_ids" eval="[
            (0, 0, {'product_id': ref('product_product_telefonia'), 'price_unit': 250.0, 'quantity': 1}),
        ]"/>
    </record>
    <function model="account.move.line" name="_onchange_product_id" context="{'check_move_validity': False}">
        <value model="account.move.line" eval="obj().search([('move_id', '=', ref('demo_invoice_15'))]).ids"/>
    </function>
    <function model="account.move" name="_recompute_dynamic_lines" context="{'check_move_validity': False}">
        <value eval="[ref('demo_invoice_15')]"/>
        <value eval="True"/>
    </function>


    <!-- Export invoice to expresso, fiscal position changes tax to exempt (type 1 because it have products only, used to test refund of expo) -->
    <record id="demo_invoice_16" model="account.move">
        <field name="partner_id" ref="res_partner_expresso"/>
        <field name="invoice_user_id" ref="base.user_demo"/>
        <field name="fiscal_position_id" model="account.fiscal.position" eval="obj().search([('company_id', '=', obj().env.ref('l10n_ar.company_ri').id), ('name', '=', 'Operaciones exentas')], limit=1).id"/>
        <field name="invoice_payment_term_id" ref="account.account_payment_term"/>
        <field name="type">out_invoice</field>
        <field name="invoice_date" eval="time.strftime('%Y-%m')+'-22'"/>
        <field name="company_id" ref="company_ri"/>
        <field name="invoice_incoterm_id" ref="account.incoterm_EXW"/>
        <field name="invoice_line_ids" eval="[
            (0, 0, {'product_id': ref('product.product_product_27'), 'price_unit': 642.0, 'quantity': 5}),
        ]"/>
    </record>
    <function model="account.move.line" name="_onchange_product_id" context="{'check_move_validity': False}">
        <value model="account.move.line" eval="obj().search([('move_id', '=', ref('demo_invoice_16'))]).ids"/>
    </function>
    <function model="account.move" name="_recompute_dynamic_lines" context="{'check_move_validity': False}">
        <value eval="[ref('demo_invoice_16')]"/>
        <value eval="True"/>
    </function>

    <function model="account.move" name="post">
        <value eval="[ref('demo_invoice_6'), ref('demo_invoice_7'), ref('demo_invoice_14'), ref('demo_invoice_15'), ref('demo_invoice_16')]"/>
    </function>

</odoo>
