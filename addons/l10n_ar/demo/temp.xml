<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Invoice to ADHOC with multiple taxes and perceptions -->
    <record id="demo_sup_invoice_7" model="account.move">
        <field name="partner_id" ref="l10n_ar.res_partner_adhoc"/>
        <field name="invoice_user_id" ref="base.user_demo"/>
        <field name="invoice_payment_term_id" ref="account.account_payment_term_end_following_month"/>
        <field name="type">in_invoice</field>
        <field name="invoice_date" eval="time.strftime('%Y-%m')+'-01'"/>
        <field name="company_id" ref="company_ri"/>
        <field name="invoice_line_ids" eval="[
            (0, 0, {'product_id': ref('product.product_product_27'), 'price_unit': 642.0, 'quantity': 5}),
            (0, 0, {'product_id': ref('product_product_telefonia'), 'price_unit': 250.0, 'quantity': 1}),
            (0, 0, {'product_id': ref('product.product_product_25'), 'price_unit': 3245.0, 'quantity': 2}),
        ]"/>
    </record>

    <function model="account.move.line" name="_onchange_product_id" context="{'check_move_validity': False}">
        <value model="account.move.line" eval="obj().search([('move_id', 'in', [ref('demo_sup_invoice_7')])]).ids"/>
    </function>

    <function model="account.move.line" name="write" context="{'check_move_validity': False, 'active_test': False}">
        <value model="account.move.line" search="[('move_id', '=', ref('demo_sup_invoice_7')), ('product_id', '=', ref('product.product_product_27'))]"/>
        <value model="account.tax" eval="{'tax_ids': [(4, obj().search([('company_id', '=', ref('company_ri')), ('type_tax_use', '=', 'purchase'), ('tax_group_id.l10n_ar_tribute_afip_code', '=', '06')], limit=1).id)]}"/>
    </function>

    <function model="account.move.line" name="write" context="{'check_move_validity': False, 'active_test': False}">
        <value model="account.move.line" search="[('move_id', '=', ref('demo_sup_invoice_7')), ('product_id', '=', ref('product_product_telefonia'))]"/>
        <value model="account.tax" eval="{'tax_ids': [(4, obj().search([('company_id', '=', ref('company_ri')), ('type_tax_use', '=', 'purchase'), ('tax_group_id.l10n_ar_tribute_afip_code', '=', '07')], limit=1).id)]}"/>
    </function>

    <function model="account.move.line" name="write" context="{'check_move_validity': False, 'active_test': False}">
        <value model="account.move.line" search="[('move_id', '=', ref('demo_sup_invoice_7')), ('product_id', '=', ref('product.product_product_25'))]"/>
        <value model="account.tax" eval="{'tax_ids': [(4, obj().search([('company_id', '=', ref('company_ri')), ('type_tax_use', '=', 'purchase'), ('tax_group_id.l10n_ar_tribute_afip_code', '=', '99')], limit=1).id)]}"/>
    </function>

    <function model="account.move" name="_recompute_dynamic_lines" context="{'check_move_validity': False}">
        <value eval="[ref('demo_sup_invoice_7')]"/>
        <value eval="True"/>
    </function>

    <!-- TODO  un "other taxes",  "perc de iva" y "perc de iibb" -->
    <!-- TODO * factura de proveedor que puede ser anÃ¡loga a la anterior -->

    <!-- <function model="account.move" name="post">
        <value eval="[ref('demo_sup_invoice_7')]"/>
    </function> -->

</odoo>
